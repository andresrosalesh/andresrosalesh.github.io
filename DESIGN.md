# Design of Deep Worker

# Structure 

## Deep Worker uses the Python Flask framework to serve the web application. Each HTML page generated by the program follows a template - ```layout.html``` - which provides the website with its basic structure and Bootstrap navigation bar.

## The Python application lives in the root directory as ```application.py```, supported by a helper program ```helpers.py```, also in the root. The JavaScript programs, ```timer.js```, ```trends.js```, and ```logs.js```, live in the `static/scripts` directory. The HTML templates live under `/templates/`, while the single CSS script lies in `/static/`, as well as the pictures required for the application.

## There is one SQLite 3 Database `deepwork.db` which contains 4 tables: users, timings, wbdata, and shwork. Users contains user information. Timings contains time tracking submissions made by the user on the home page. Wbdata stands for well-being data and contains shutdown submissions. Shwork contains leftover time which the user did not log with the time tracking feature.

## Below are design descriptions of each of the core features of the application. 

# HomePage and Time Tracking

## The home page `index.html` is generated by the ```index()``` function and route in `application.py`. On `index.html`, there is a basic layout for the time tracking module, and linked is a JavaScript program `timer.js`. 

## The script controls the dynamic stopwatch feature on the homepage by keeping track of time when the user hits the **start** button on the home page and stopping the tracking when the user hits **stop**. It also has support to **reset** the time tracking. When the user hits **submit**, the script uses jQuery Ajax to send a POST request to the Flask application.

## In the `index()` function in `application.py`, if the user arrived via a POST method, that means the user submitted a time tracking via the post from `timer.js`. The application then parses the data and inserts it into the timings table in the database. 

## If the user did not come from a POST request, then the page `index.html` is simply generated. 

# Trends

##  The page `trends.html` is generated by the `trends()` function and route in `application.py`. On `trends.html`, there is a layout for a line graph which displays trends and a section for analytics. Linked is a JavaScript program `trends.js`, where the line graph and analytics are generated. To use a basic layout for the line graph and, we utilized the `chart.js` library, which is linked in the `trends.html` page as external source code.

## In `application.py`, `trends()` queries data from the timings table to reflect the data back in the `trends.html` line graph. It contains one check to see if the user requested to view a monthly view on the trends page; otherwise, the default is a weekly trends page. It sends the data to the `trends.html` page. An important function `update_nw_values()` is called from `helpers.py`. This function updates the user's previous work days with "no work" times, calculating the difference between the user's daily work requirements and their actual logged time. This is reflected in the trends graph, so it is important to update this data prior to generating the graph. 

## In `trends.js`, the data received is formatted properly for the line graph. The large helper function `dw_graph_week()` performs the formatting and returns 4 arrays, 1 with the x axis as days of the week, and 3 with the y axes, the deep, shallow, and no work lines. 

## After generating the graph, it also computes statistics using well-being data, generating the relevant statistics for the analytics section of the page.

# Logs

## In `application.py`, the `logs()` function and route gets all of the user's data and returns it to the `logs.html` page. A script `logs.js` formats this data to enter it in a table. 

# Profile, Registration, Log In, Shutdown

## These HTML pages are largely simple text pages with forms linked to routes in `application.py`, generating users, updating their data, and logging them in. 